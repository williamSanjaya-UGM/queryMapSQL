create or replace PROCEDURE USP_ETSD_INQ_BOTTOM_TOP_APP(
    METHOD_NAME IN VARCHAR2,
    INQ_CURSOR OUT SYS_REFCURSOR
)AS
    V_STATEMENT VARCHAR2(2000);
BEGIN
    --BELUM DITAMBAHKAN PAGING FETCH ROW, JUGA CEK KOLOM YG DIPAKE
    V_STATEMENT:='SELECT DISTINCT MASTAPP.NAME APPNAME, MASTAPP.LVL_NAME APPLVL_NAME
    FROM ETSD_TABLE MASTCODE
    JOIN ETSD_MAPPING MAPCODE
        ON MASTCODE.ID=MAPCODE.CHILD_ID
    JOIN ETSD_TABLE MASTSF
        ON MASTSF.ID=MAPCODE.PARENT_ID
    JOIN ETSD_MAPPING MAPSF
        ON MASTSF.ID =MAPSF.CHILD_ID
    JOIN ETSD_TABLE MASTF
        ON MASTF.ID=MAPSF.PARENT_ID
    JOIN ETSD_MAPPING MAPF
        ON MASTF.ID=MAPF.CHILD_ID
    JOIN ETSD_TABLE MASTSM
         ON MASTSM.ID=MAPF.PARENT_ID
    JOIN ETSD_MAPPING MAPSM
        ON MASTSM.ID=MAPSM.CHILD_ID
    JOIN ETSD_TABLE MASTM
        ON MASTM.ID=MAPSM.PARENT_ID
    JOIN ETSD_MAPPING MAPM
        ON MASTM.ID=MAPM.CHILD_ID
    JOIN ETSD_TABLE MASTAPP
        ON MASTAPP.ID=MAPM.PARENT_ID';

    IF METHOD_NAME IS NOT NULL THEN
        V_STATEMENT:=V_STATEMENT || ' WHERE MASTCODE.NAME LIKE '||''''||UPPER(METHOD_NAME)||'%''';
    END IF;

    OPEN INQ_CURSOR FOR V_STATEMENT;
END;